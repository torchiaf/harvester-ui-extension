(("undefined"!==typeof self?self:this)["webpackChunkharvester_1_0_1"]=("undefined"!==typeof self?self:this)["webpackChunkharvester_1_0_1"]||[]).push([[648],{27547:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return U},ksmtunedMode:function(){return k},ksmtunedRunOption:function(){return w}});var s=a(9274);const o={class:"row"},l={class:"col span-6"},r={class:"col span-6"},n={class:"row"},i={class:"col span-6"},d={class:"col span-6"},u={class:"row"},c={class:"col span-6"};function m(e,t,a,m,p,v){const h=(0,s.resolveComponent)("LabeledSelect"),b=(0,s.resolveComponent)("UnitInput"),y=(0,s.resolveComponent)("Checkbox"),f=(0,s.resolveComponent)("t"),g=(0,s.resolveComponent)("RadioGroup"),N=(0,s.resolveComponent)("LabeledInput");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createVNode)(h,{value:p.spec.run,"onUpdate:value":t[0]||(t[0]=e=>p.spec.run=e),label:e.t("harvester.host.ksmtuned.run"),options:p.ksmtunedRunOption,class:"mb-20",mode:a.mode,required:""},null,8,["value","label","options","mode"]),v.showKsmt?((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:0},[(0,s.createVNode)(b,{value:p.spec.thresCoef,"onUpdate:value":t[1]||(t[1]=e=>p.spec.thresCoef=e),valueModifiers:{number:!0},label:e.t("harvester.host.ksmtuned.thresCoef"),suffix:"%",delay:0,required:"",mode:a.mode,class:"mb-20"},null,8,["value","label","mode"]),(0,s.createVNode)(y,{value:p.enableMergeAcrossNodes,"onUpdate:value":t[2]||(t[2]=e=>p.enableMergeAcrossNodes=e),mode:a.mode,class:"check mb-20",type:"checkbox",label:e.t("harvester.host.ksmtuned.enableMergeNodes")},null,8,["value","mode","label"]),(0,s.createElementVNode)("h3",null,[(0,s.createVNode)(f,{k:"harvester.host.ksmtuned.modeLink",raw:!0,url:v.ksmtunedLink},null,8,["url"])]),(0,s.createVNode)(g,{value:p.spec.mode,"onUpdate:value":t[3]||(t[3]=e=>p.spec.mode=e),class:"mb-20",name:e.t("harvester.host.ksmtuned.mode"),options:p.ksmtunedMode},null,8,["value","name","options"]),v.isCustomizedMode?((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,{key:0},[(0,s.createElementVNode)("div",o,[(0,s.createElementVNode)("div",l,[(0,s.createVNode)(N,{value:p.spec.ksmtunedParameters.boost,"onUpdate:value":t[4]||(t[4]=e=>p.spec.ksmtunedParameters.boost=e),valueModifiers:{number:!0},required:"",type:"number",label:e.t("harvester.host.ksmtuned.parameters.boost"),tooltip:e.t("harvester.host.ksmtuned.parameters.description.boost"),class:"mb-20",mode:a.mode},null,8,["value","label","tooltip","mode"])]),(0,s.createElementVNode)("div",r,[(0,s.createVNode)(N,{value:p.spec.ksmtunedParameters.decay,"onUpdate:value":t[5]||(t[5]=e=>p.spec.ksmtunedParameters.decay=e),valueModifiers:{number:!0},required:"",type:"number",label:e.t("harvester.host.ksmtuned.parameters.decay"),tooltip:e.t("harvester.host.ksmtuned.parameters.description.decay"),class:"mb-20",mode:a.mode},null,8,["value","label","tooltip","mode"])])]),(0,s.createElementVNode)("div",n,[(0,s.createElementVNode)("div",i,[(0,s.createVNode)(N,{value:p.spec.ksmtunedParameters.minPages,"onUpdate:value":t[6]||(t[6]=e=>p.spec.ksmtunedParameters.minPages=e),valueModifiers:{number:!0},required:"",type:"number",label:e.t("harvester.host.ksmtuned.parameters.minPages"),tooltip:e.t("harvester.host.ksmtuned.parameters.description.minPages"),class:"mb-20",mode:a.mode},null,8,["value","label","tooltip","mode"])]),(0,s.createElementVNode)("div",d,[(0,s.createVNode)(N,{value:p.spec.ksmtunedParameters.maxPages,"onUpdate:value":t[7]||(t[7]=e=>p.spec.ksmtunedParameters.maxPages=e),valueModifiers:{number:!0},required:"",type:"number",label:e.t("harvester.host.ksmtuned.parameters.maxPages"),tooltip:e.t("harvester.host.ksmtuned.parameters.description.maxPages"),class:"mb-20",mode:a.mode},null,8,["value","label","tooltip","mode"])])]),(0,s.createElementVNode)("div",u,[(0,s.createElementVNode)("div",c,[(0,s.createVNode)(N,{value:p.spec.ksmtunedParameters.sleepMsec,"onUpdate:value":t[8]||(t[8]=e=>p.spec.ksmtunedParameters.sleepMsec=e),valueModifiers:{number:!0},required:"",type:"number",label:e.t("harvester.host.ksmtuned.parameters.sleepMsec"),tooltip:e.t("harvester.host.ksmtuned.parameters.description.sleepMsec"),class:"mb-20",mode:a.mode},null,8,["value","label","tooltip","mode"])])])],64)):(0,s.createCommentVNode)("",!0)],64)):(0,s.createCommentVNode)("",!0)])}var p=a(40408),v=a(79380),h=a(84215),b=a(10196),y=a(42200),f=a(32766),g=a(66242),N=a(3791);const k=[{value:"standard",label:"Standard"},{value:"high",label:"High-Perfomanace"},{value:"customized",label:"Customized"}],w=[{label:"Run",value:"run"},{label:"Stop",value:"stop"},{label:"Prune",value:"prune"}];var V={name:"HarvesterKsmtuned",components:{Checkbox:y.S,LabeledInput:v.o,LabeledSelect:p.A,RadioGroup:b.z,UnitInput:h.A},props:{mode:{type:String,required:!0},node:{type:Object,required:!0},registerBeforeHook:{type:Function,required:!0}},async fetch(){const e=this.$store.getters["currentProduct"].inStore,t=await this.$store.dispatch(`${e}/findAll`,{type:f.rk.KSTUNED});this.ksmtuned=t.find((e=>e.id===this.node.id)),this.enableMergeAcrossNodes=!!this.ksmtuned.spec?.mergeAcrossNodes,this.spec=this.ksmtuned.spec},data(){return{ksmtuned:{},spec:{},thresCoef:30,ksmtunedMode:k,ksmtunedRunOption:w,enableMergeAcrossNodes:!0}},created(){this.registerBeforeHook(this.saveKsmtuned,"saveKsmtuned")},computed:{isCustomizedMode(){return"customized"===this.spec.mode},showKsmt(){return"run"===this.spec.run},ksmtunedLink(){const e=this.$store.getters["harvester-common/getServerVersion"]();return(0,N.nn)(g.d.KSMTUNED_MODE,e)}},methods:{async saveKsmtuned(){this.spec.mergeAcrossNodes=this.enableMergeAcrossNodes?1:0,this.ksmtuned["spec"]=this.spec,await this.ksmtuned.save().catch((e=>{if("error"===e?.type)return this.$store.dispatch("growl/error",{title:this.t("harvester.notification.title.error"),message:e?.message},{root:!0}),Promise.reject(new Error("saveKsmtuned error"))}))}}},C=a(47433);const E=(0,C.A)(V,[["render",m]]);var U=E},58094:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var s=a(9274);const o={class:"vm__credentials-users"};function l(e,t,a,l,r,n){const i=(0,s.resolveComponent)("LabeledSelect"),d=(0,s.resolveComponent)("LabeledInput"),u=(0,s.resolveComponent)("ModalWithCard");return(0,s.openBlock)(),(0,s.createElementBlock)("div",o,[(0,s.createVNode)(i,{value:r.selectedUser,"onUpdate:value":t[0]||(t[0]=e=>r.selectedUser=e),options:a.userOptions,label:e.t("harvester.virtualMachine.accessCredentials.injectSSH.users"),taggable:a.multiple,mode:a.mode,multiple:a.multiple,searchable:!1,tooltip:e.t("harvester.virtualMachine.accessCredentials.userTips"),class:(0,s.normalizeClass)({hasUsers:r.selectedUser.length>0}),onInput:n.update},null,8,["value","options","label","taggable","mode","multiple","tooltip","class","onInput"]),r.isOpen?((0,s.openBlock)(),(0,s.createBlock)(u,{key:0,name:r.randomStr,width:"40%",errors:r.errors,onFinish:n.addUser,onClose:n.cancel},{title:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.t("harvester.virtualMachine.accessCredentials.injectSSH.addUser")),1)])),content:(0,s.withCtx)((()=>[(0,s.createVNode)(d,{value:r.newUsername,"onUpdate:value":t[1]||(t[1]=e=>r.newUsername=e),label:e.t("harvester.virtualMachine.input.username"),class:"mb-20",required:"",onKeydown:t[2]||(t[2]=(0,s.withKeys)((0,s.withModifiers)((()=>{}),["prevent"]),["native","enter"]))},null,8,["value","label"])])),_:1},8,["name","errors","onFinish","onClose"])):(0,s.createCommentVNode)("",!0)])}var r=a(65359),n=a(76978),i=a(92043),d=a(79380),u=a(40408),c=a(40973);const m="_NEW";var p={emits:["update:user","update:newUser"],components:{LabeledInput:d.o,LabeledSelect:u.A,ModalWithCard:c.A},props:{value:{type:[Array,String],default:()=>[]},resourceType:{type:Object,default:()=>({})},userOptions:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!1},mode:{type:String,default:"create"},disabled:{type:Boolean,default:!1}},data(){return{selectedUser:this.value,newUsername:"",randomStr:(0,i.vx)(5).toLowerCase(),errors:[],isOpen:!1}},computed:{...(0,r.L8)({t:"i18n/t"})},watch:{value(e){this.selectedUser=e},selectedUser(e,t){e.includes(m)&&(this["selectedUser"]=t,this.update(),this.show())}},methods:{update(){this.$emit("update:user",(0,n.o8)(this.selectedUser))},addUser(e){const t=/^[-._0-9a-zA-Z]+$/;if(this.errors=[],!t.test(this.newUsername)){const t=this.t("harvester.virtualMachine.accessCredentials.invalidUser");return this.errors.push(t),void e(!1)}if(this.userOptions.includes(this.newUsername)){const t=this.t("harvester.virtualMachine.accessCredentials.duplicatedUser");return this.errors.push(t),void e(!1)}this.multiple?this.selectedUser.push(this.newUsername):this.selectedUser=this.newUsername,this.$emit("update:newUser",this.newUsername),this.update(),e(!0),this.cancel()},show(){this.isOpen=!0},hide(){this.isOpen=!1},cancel(){this.hide(),this.newUsername=""}}},v=(a(84388),a(47433));const h=(0,v.A)(p,[["render",l]]);var b=h},60068:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return w}});var s=a(9274);const o=e=>((0,s.pushScopeId)("data-v-61977bc4"),e=e(),(0,s.popScopeId)(),e),l=["onClick"],r=o((()=>(0,s.createElementVNode)("i",{class:"icon icon-x"},null,-1))),n=[r],i={key:0,class:"mt-20"};function d(e,t,a,o,r,d){const u=(0,s.resolveComponent)("Banner"),c=(0,s.resolveComponent)("InfoBox");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createVNode)(u,{class:"mb-20",color:"info",label:e.t("harvester.virtualMachine.accessCredentials.tips")},null,8,["label"]),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.rows,((e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t},[(0,s.createVNode)(c,{class:"volume-source"},{default:(0,s.withCtx)((()=>[d.isEdit?((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:0,type:"button",class:"role-link btn btn-sm remove-vol",onClick:t=>d.remove(e)},n,8,l)):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("h3",null,[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(d.headerFor(e.source)),1)]),(0,s.createElementVNode)("div",null,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(d.componentFor(e.source)),{value:r.rows[t],"onUpdate:value":e=>r.rows[t]=e,rows:r.rows,"resource-type":a.resourceType,"user-options":d.userOptions,mode:a.mode,idx:t,onUpdate:d.update,"onUpdate:newUser":d.updateNewUser},null,40,["value","onUpdate:value","rows","resource-type","user-options","mode","idx","onUpdate","onUpdate:newUser"]))])])),_:2},1024)])))),128)),d.isEdit&&a.isQemuInstalled?((0,s.openBlock)(),(0,s.createElementBlock)("div",i,[(0,s.createElementVNode)("button",{type:"button",class:"btn btn-sm bg-primary mr-15 mb-10",onClick:t[0]||(t[0]=e=>d.addCredentials(r.ACCESS_CREDENTIALS.RESET_PWD))},(0,s.toDisplayString)(e.t("harvester.virtualMachine.accessCredentials.resetPwd.label")),1),(0,s.createElementVNode)("button",{type:"button",class:"btn btn-sm bg-primary mr-15 mb-10",onClick:t[1]||(t[1]=e=>d.addCredentials(r.ACCESS_CREDENTIALS.INJECT_SSH))},(0,s.toDisplayString)(e.t("harvester.virtualMachine.accessCredentials.injectSSH.label")),1)])):(0,s.createCommentVNode)("",!0)])}var u=a(65359),c=a(9980),m=a(26962),p=a(92043),v=a(68851),h=a(14220),b=a(2602),y=a(66905);const f="_NEW";var g={emits:["update:value"],components:{Banner:c.l,InfoBox:m.A},props:{value:{type:Array,default:()=>[]},resourceType:{type:Object,default:()=>({})},mode:{type:String,default:"create"},disableCreate:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},isQemuInstalled:{type:Boolean,default:!1}},data(){return{ACCESS_CREDENTIALS:y.cI,toRemove:[],toSave:[],rows:[],newUserOptions:[]}},computed:{...(0,u.L8)({t:"i18n/t"}),isEdit(){return this.mode===h.G5},historyUsersOptions(){const e=JSON.parse(this.resourceType?.spec?.template?.metadata?.annotations?.[b.r.DYNAMIC_SSHKEYS_USERS]||"[]");return e.unshift({label:this.t("harvester.virtualMachine.accessCredentials.injectSSH.addUser"),value:f}),e},userOptions(){return Array.from(new Set([...this.historyUsersOptions,...this.newUserOptions]))}},watch:{value:{handler(e){this.rows=[...e]},deep:!0,immediate:!0}},methods:{addCredentials(e){const t={source:e,users:[],sshkeys:[],username:"",newPassword:"",secretName:this.generateSecretName(this.resourceType.metadata.name)};this.rows.push(t),this.update()},remove(e){(0,v.Gj)(this.rows,e),this.update()},update(){this.$emit("update:value",this.rows)},updateNewUser(e){this.newUserOptions.push(e)},generateSecretName(e){return e?`${e}-${(0,p.vx)(5).toLowerCase()}`:void 0},componentFor(e){switch(e){case y.cI.RESET_PWD:return a(23574)["default"];case y.cI.INJECT_SSH:return a(18933)["default"]}},headerFor(e){return{userPassword:this.$store.getters["i18n/t"]("harvester.virtualMachine.accessCredentials.resetPwd.label"),sshPublicKey:this.$store.getters["i18n/t"]("harvester.virtualMachine.accessCredentials.injectSSH.label")}[e]}}},N=(a(38239),a(47433));const k=(0,N.A)(g,[["render",d],["__scopeId","data-v-61977bc4"]]);var w=k},23574:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var s=a(9274);const o={class:"col span-6"},l={class:"col span-6"};function r(e,t,a,r,n,i){const d=(0,s.resolveComponent)("AccessCredentialsUsers"),u=(0,s.resolveComponent)("Password");return(0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"row","onUpdate:value":t[2]||(t[2]=(...e)=>i.update&&i.update(...e))},[(0,s.createElementVNode)("div",o,[(0,s.createVNode)(d,{value:a.value.username,"onUpdate:value":t[0]||(t[0]=e=>a.value.username=e),"resource-type":a.resourceType,"user-options":a.userOptions,multiple:!1,mode:a.mode,"onUpdate:user":i.updateUser,"onUpdate:newUser":i.updateNewUser},null,8,["value","resource-type","user-options","mode","onUpdate:user","onUpdate:newUser"])]),(0,s.createElementVNode)("div",l,[(0,s.createVNode)(u,{ref:"password",value:a.value.newPassword,"onUpdate:value":t[1]||(t[1]=e=>a.value.newPassword=e),mode:a.mode,disabled:"edit"!==a.mode,label:e.t("harvester.virtualMachine.input.password"),required:""},null,8,["value","mode","disabled","label"])])],32)}var n=a(21414),i=a(58094),d={name:"HarvesterEditVolume",emits:["update","update:newUser"],components:{Password:n.A,AccessCredentialsUsers:i["default"]},props:{mode:{type:String,default:"create"},resourceType:{type:Object,default:()=>({})},userOptions:{type:Array,default:()=>[]},value:{type:Object,default:()=>({})}},data(){return{defaultPwdValue:{username:"",newPassword:""}}},methods:{update(){this.$emit("update")},updateUser(e){this.value["username"]=e,this.update()},updateNewUser(e){this.$emit("update:newUser",e)}}},u=(a(27461),a(47433));const c=(0,u.A)(d,[["render",r],["__scopeId","data-v-7d19b7bd"]]);var m=c},18933:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var s=a(9274);const o={class:"columns row"},l={class:"col span-6"},r={class:"col span-6"};function n(e,t,a,n,i,d){const u=(0,s.resolveComponent)("AccessCredentialsUsers"),c=(0,s.resolveComponent)("SSHKey");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",o,[(0,s.createElementVNode)("div",l,[(0,s.createVNode)(u,{value:a.value.users,"onUpdate:value":t[0]||(t[0]=e=>a.value.users=e),"resource-type":a.resourceType,"user-options":a.userOptions,mode:a.mode,multiple:!0,"onUpdate:user":d.updateUser,"onUpdate:newUser":d.updateNewUser},null,8,["value","resource-type","user-options","mode","onUpdate:user","onUpdate:newUser"])]),(0,s.createElementVNode)("div",r,[(0,s.createVNode)(c,{value:a.value.sshkeys,"onUpdate:value":t[1]||(t[1]=e=>a.value.sshkeys=e),class:"mb-20",namespace:a.resourceType.metadata.namespace,mode:a.mode,searchable:!1,"onUpdate:sshKey":d.updateSSH},null,8,["value","namespace","mode","onUpdate:sshKey"])])])])}var i=a(78025),d=a(58094),u={name:"HarvesterEditVolume",emits:["update","update:newUser"],components:{SSHKey:i["default"],AccessCredentialsUsers:d["default"]},props:{mode:{type:String,default:"create"},resourceType:{type:Object,default:()=>({})},userOptions:{type:Array,default:()=>[]},value:{type:Object,default:()=>({})}},methods:{update(){this.$emit("update")},updateUser(e){this.value["users"]=e,this.update()},updateSSH(e){this.value["sshkeys"]=e,this.update()},updateNewUser(e){this.$emit("update:newUser",e)}}},c=a(47433);const m=(0,c.A)(u,[["render",n]]);var p=m},16369:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var s=a(9274);const o={class:"mb-20"},l={class:"text-muted mb-20"},r={class:"resource-yaml"};function n(e,t,a,n,i,d){const u=(0,s.resolveComponent)("t"),c=(0,s.resolveComponent)("LabeledSelect"),m=(0,s.resolveComponent)("YamlEditor");return(0,s.openBlock)(),(0,s.createElementBlock)("div",o,[(0,s.createElementVNode)("h3",null,(0,s.toDisplayString)(e.t(`harvester.virtualMachine.cloudConfig.${a.type}.title`)),1),(0,s.createElementVNode)("p",l,[(0,s.createVNode)(u,{k:`harvester.virtualMachine.cloudConfig.${a.type}.tip`,raw:!0},null,8,["k"])]),d.isView?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createBlock)(c,{key:0,value:i.id,"onUpdate:value":t[0]||(t[0]=e=>i.id=e),class:"mb-20",options:a.options,disabled:a.viewCode,"label-key":`harvester.virtualMachine.cloudConfig.${a.type}.label`},null,8,["value","options","disabled","label-key"])),(0,s.createElementVNode)("div",r,[(0,s.createVNode)(m,{ref:"yaml",value:i.yamlScript,"onUpdate:value":t[1]||(t[1]=e=>i.yamlScript=e),class:"yaml-editor","editor-mode":d.editorMode},null,8,["value","editor-mode"])])])}var i=a(65359),d=a(40408),u=a(5616),c=a(14220),m=a(35664);const p="_NEW",v="_NONE";var h={components:{YamlEditor:u.A,LabeledSelect:d.A},emits:["updateTemplateId","show","update"],props:{mode:{type:String,default:"create"},value:{type:String,default:""},type:{type:String,default:""},options:{type:Array,default:()=>[]},configId:{type:String,default:""},viewCode:{type:Boolean,default:!1}},data(){return{id:"",yamlScript:this.value}},computed:{...(0,i.L8)({t:"i18n/t"}),editorMode(){return this.isView||this.viewCode?u.j.VIEW_CODE:u.j.EDIT_CODE},isView(){return this.mode===c.nW}},watch:{value(e){this.yamlScript=e},configId(e){this.id=this.configId},id(e,t){const a=this.$store.getters["harvester/byId"](m.K5,e)?.data?.cloudInit||"";if(this.$emit("updateTemplateId",this.type,e),e){if(e===p)return this.$emit("show",this.type),void(this.id=t);this.yamlScript=e===v?"":a,this.$refs["yaml"].updateValue(a)}},yamlScript(e){this.$emit("update",e,this.type)}},methods:{refresh(){this.$refs.yaml.refresh()},updateValue(){this.$refs["yaml"].updateValue(this.value)}}},b=(a(71157),a(47433));const y=(0,b.A)(h,[["render",n],["__scopeId","data-v-1613a356"]]);var f=y},81559:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return w}});var s=a(9274);const o={key:0},l={class:"mb-20"},r={class:"mb-20"},n={class:"yaml"},i={class:"resource-yaml"};function d(e,t,a,d,u,c){const m=(0,s.resolveComponent)("DataTemplate"),p=(0,s.resolveComponent)("LabeledInput"),v=(0,s.resolveComponent)("YamlEditor"),h=(0,s.resolveComponent)("ModalWithCard");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[c.isView?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("h2",o,(0,s.toDisplayString)(e.t("harvester.virtualMachine.cloudConfig.title")),1)),(0,s.createElementVNode)("div",l,[(0,s.createVNode)(m,{ref:"userTemplate",value:a.userScript,type:"user","view-code":a.viewCode,mode:a.mode,"config-id":u.configUserId,options:u.optionUser,onShow:c.show,onUpdate:c.update,onUpdateTemplateId:c.updateTemplateId},null,8,["value","view-code","mode","config-id","options","onShow","onUpdate","onUpdateTemplateId"])]),(0,s.createElementVNode)("div",r,[(0,s.createVNode)(m,{ref:"networkTemplate",value:a.networkScript,type:"network","view-code":a.viewCode,mode:a.mode,"config-id":u.configNetworkId,options:u.optionNetwork,onShow:c.show,onUpdate:c.update},null,8,["value","view-code","mode","config-id","options","onShow","onUpdate"])]),u.isOpen?((0,s.openBlock)(),(0,s.createBlock)(h,{key:1,name:"createCloudTemplate",width:"40%",errors:u.errors,onFinish:c.save,onClose:c.cancel},{title:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.t("harvester.virtualMachine.cloudConfig.createTemplateTitle",{name:c.createTypeLable})),1)])),content:(0,s.withCtx)((()=>[(0,s.createVNode)(p,{value:u.cloudTemplateName,"onUpdate:value":t[0]||(t[0]=e=>u.cloudTemplateName=e),label:e.t("harvester.virtualMachine.input.name"),class:"mb-20",required:"",onKeydown:t[1]||(t[1]=(0,s.withKeys)((0,s.withModifiers)((()=>{}),["prevent"]),["native","enter"]))},null,8,["value","label"]),(0,s.createElementVNode)("div",n,[(0,s.createElementVNode)("div",i,[(0,s.createVNode)(v,{ref:"createTemplate",value:u.cloudTemplate,"onUpdate:value":t[2]||(t[2]=e=>u.cloudTemplate=e),class:"yaml-editor","editor-mode":c.editorMode},null,8,["value","editor-mode"])])])])),_:1},8,["errors","onFinish","onClose"])):(0,s.createCommentVNode)("",!0)])}var u=a(65359),c=a(79380),m=a(5616),p=a(40973),v=a(35664),h=a(2602),b=a(14220),y=a(16369);const f="_NEW";var g={emits:["updateUserData","updateNetworkData","updateDataTemplateId"],components:{DataTemplate:y["default"],YamlEditor:m.A,LabeledInput:c.o,ModalWithCard:p.A},props:{mode:{type:String,default:"create"},namespace:{type:String,default:""},userScript:{type:String,default:""},networkScript:{type:String,default:""},viewCode:{type:Boolean,default:!1}},data(){return{errors:[],templateType:"",cloudTemplate:"",cloudTemplateName:"",configUserId:"",configNetworkId:"",optionUser:[],optionNetwork:[],isOpen:!1}},async fetch(){const e=await this.$store.dispatch("harvester/findAll",{type:v.K5}),t=[],a=[];for(const s of e)"user"===s.metadata?.labels?.[h.r.CLOUD_INIT]&&t.push({label:s?.id,value:s?.id}),"network"===s.metadata?.labels?.[h.r.CLOUD_INIT]&&a.push({label:s?.id,value:s?.id});t.unshift({label:this.t("harvester.virtualMachine.cloudConfig.createNew"),value:f}),a.unshift({label:this.t("harvester.virtualMachine.cloudConfig.createNew"),value:f}),this.optionUser=t,this.optionNetwork=a},computed:{...(0,u.L8)({t:"i18n/t"}),createTypeLable(){const e=`harvester.virtualMachine.cloudConfig.${this.templateType}.label`;return this.t(e)},editorMode(){return this.isView?m.j.VIEW_CODE:m.j.EDIT_CODE},isView(){return this.mode===b.nW}},methods:{updateValue(){this.$refs["userTemplate"].updateValue(),this.$refs["networkTemplate"].updateValue()},update(e,t){"user"===t&&this.$emit("updateUserData",e),"network"===t&&this.$emit("updateNetworkData",e)},updateTemplateId(e,t){this.$emit("updateDataTemplateId",e,t)},show(e){this.templateType=e,this.isOpen=!0},async save(e){if(this.errors=[],!this.cloudTemplateName)return this.errors.push(this.t("validation.required",{key:this.t("harvester.virtualMachine.input.name")},!0)),void e(!1);if(!this.cloudTemplate){const t="user"===this.templateType?"harvester.cloudTemplate.userData":"harvester.cloudTemplate.networkData";return this.errors.push(this.t("validation.required",{key:this.t(t)},!0)),void e(!1)}const t=await this.$store.dispatch("harvester/create",{type:v.K5,metadata:{labels:{[h.r.CLOUD_INIT]:this.templateType},name:this.cloudTemplateName,namespace:this.namespace},data:{cloudInit:this.cloudTemplate}});try{const a=await t.save();a.id&&("user"===this.templateType?this.configUserId=a.id:this.configNetworkId=a.id,this.$fetch()),e(!0),this.cancel()}catch(a){this.errors=[a.message],e(!1)}},cancel(){this.cloudTemplate="",this.cloudTemplateName="",this["errors"]=[],this.isOpen=!1},refresh(){this.$refs["userTemplate"].refresh(),this.$refs["networkTemplate"].refresh()}}},N=(a(9729),a(47433));const k=(0,N.A)(g,[["render",d],["__scopeId","data-v-2d3a6d84"]]);var w=k},75403:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var s=a(9274);const o={class:"row"},l={class:"col span-6 mb-10"},r={class:"col span-6 mb-10"};function n(e,t,a,n,i,d){const u=(0,s.resolveComponent)("UnitInput"),c=(0,s.resolveComponent)("InputOrDisplay");return(0,s.openBlock)(),(0,s.createElementBlock)("div",o,[(0,s.createElementVNode)("div",l,[(0,s.createVNode)(c,{name:"CPU",value:d.cupDisplay,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(u,{value:i.localCpu,"onUpdate:value":[t[0]||(t[0]=e=>i.localCpu=e),d.change],label:"CPU",suffix:"C",delay:0,required:"",disabled:a.disabled,mode:a.mode,class:"mb-20"},null,8,["value","disabled","mode","onUpdate:value"])])),_:1},8,["value","mode"])]),(0,s.createElementVNode)("div",r,[(0,s.createVNode)(c,{name:e.t("harvester.virtualMachine.input.memory"),value:d.memoryDisplay,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(u,{value:i.localMemory,"onUpdate:value":[t[1]||(t[1]=e=>i.localMemory=e),d.change],label:e.t("harvester.virtualMachine.input.memory"),mode:a.mode,"input-exponent":3,delay:0,increment:1024,"output-modifier":!0,disabled:a.disabled,required:"",class:"mb-20"},null,8,["value","label","mode","disabled","onUpdate:value"])])),_:1},8,["name","value","mode"])])])}var i=a(84215),d=a(60090),u={name:"HarvesterEditCpuMemory",emits:["updateCpuMemory"],components:{UnitInput:i.A,InputOrDisplay:d.A},props:{cpu:{type:Number,default:null},memory:{type:String,default:null},mode:{type:String,default:"create"},disabled:{type:Boolean,default:!1}},data(){return{localCpu:this.cpu,localMemory:this.memory}},computed:{cupDisplay(){return`${this.localCpu} C`},memoryDisplay(){return`${this.localMemory}`}},watch:{cpu(e){this.localCpu=e},memory(e){e&&!e.includes("null")&&(this.localMemory=e)}},methods:{change(){let e="";e=String(this.localMemory).includes("Gi")?this.localMemory:`${this.localMemory}Gi`,e.includes("null")&&(e=null),this.$emit("updateCpuMemory",this.localCpu,e)}}},c=a(47433);const m=(0,c.A)(u,[["render",n]]);var p=m},48893:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return C}});var s=a(9274);const o={class:"row mb-20"},l={"data-testid":"input-hen-name",class:"col span-6"},r={"data-testid":"input-hen-model",class:"col span-6"},n={"data-testid":"input-hen-networkName",class:"col span-6"},i={"data-testid":"input-hen-type",class:"col span-6"},d={key:0},u={class:"row mb-20"},c={class:"row"},m={key:0,"data-testid":"input-hen-macAddress",class:"col span-6"};function p(e,t,a,p,v,h){const b=(0,s.resolveComponent)("LabeledInput"),y=(0,s.resolveComponent)("InputOrDisplay"),f=(0,s.resolveComponent)("LabeledSelect");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",o,[(0,s.createElementVNode)("div",l,[(0,s.createVNode)(y,{name:e.t("harvester.fields.name"),value:a.value.name,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(b,{value:a.value.name,"onUpdate:value":[t[0]||(t[0]=e=>a.value.name=e),h.update],label:e.t("harvester.fields.name"),required:"",mode:a.mode,disabled:h.isDisabled},null,8,["value","label","mode","disabled","onUpdate:value"])])),_:1},8,["name","value","mode"])]),(0,s.createElementVNode)("div",r,[(0,s.createVNode)(y,{name:e.t("harvester.fields.model"),value:a.value.model,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(f,{value:a.value.model,"onUpdate:value":[t[1]||(t[1]=e=>a.value.model=e),h.update],label:e.t("harvester.fields.model"),disabled:h.isDisabled,options:h.modelOption,mode:a.mode,required:""},null,8,["value","label","disabled","options","mode","onUpdate:value"])])),_:1},8,["name","value","mode"])])]),(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["row",{"mb-20":!v.isMasquerade}])},[(0,s.createElementVNode)("div",n,[(0,s.createVNode)(y,{name:e.t("harvester.fields.network"),value:a.value.networkName,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(f,{value:a.value.networkName,"onUpdate:value":[t[2]||(t[2]=e=>a.value.networkName=e),h.updateNetworkName],label:e.t("harvester.fields.network"),options:h.allNetworkOption,mode:a.mode,required:"",disabled:h.isDisabled},null,8,["value","label","options","mode","disabled","onUpdate:value"])])),_:1},8,["name","value","mode"])]),(0,s.createElementVNode)("div",i,[(0,s.createVNode)(y,{name:e.t("harvester.fields.type"),value:a.value.type,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(f,{value:a.value.type,"onUpdate:value":[t[3]||(t[3]=e=>a.value.type=e),h.update],label:e.t("harvester.fields.type"),options:h.typeOption,mode:a.mode,required:""},null,8,["value","label","options","mode","onUpdate:value"])])),_:1},8,["name","value","mode"])])],2),!v.isMasquerade&&a.isSingle?((0,s.openBlock)(),(0,s.createElementBlock)("div",d,[(0,s.createElementVNode)("div",u,[(0,s.createElementVNode)("a",{role:"button",onClick:t[4]||(t[4]=(...e)=>h.toggleAdvanced&&h.toggleAdvanced(...e))},(0,s.toDisplayString)(v.showAdvanced?e.t("harvester.generic.hideMore"):e.t("harvester.generic.showMore")),1)]),(0,s.createElementVNode)("div",c,[v.showAdvanced?((0,s.openBlock)(),(0,s.createElementBlock)("div",m,[(0,s.createVNode)(y,{name:e.t("harvester.fields.macAddress"),value:a.value.macAddress,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(b,{value:a.value.macAddress,"onUpdate:value":[t[5]||(t[5]=e=>a.value.macAddress=e),h.update],"label-key":"harvester.fields.macAddress",mode:a.mode,tooltip:e.t("harvester.virtualMachine.volume.macTip")},null,8,["value","mode","tooltip","onUpdate:value"])])),_:1},8,["name","value","mode"])])):(0,s.createCommentVNode)("",!0)])])):(0,s.createCommentVNode)("",!0)])}var v=a(60090),h=a(79380),b=a(40408),y=a(76978),f=a(14220),g=a(48249);const N=[{label:"virtio",value:"virtio"},{label:"e1000",value:"e1000"},{label:"e1000e",value:"e1000e"},{label:"ne2k_pci",value:"ne2k_pci"},{label:"pcnet",value:"pcnet"},{label:"rtl8139",value:"rtl8139"}];var k={name:"HarvesterEditNetwork",emits:["update"],components:{LabeledInput:h.o,LabeledSelect:b.A,InputOrDisplay:v.A},props:{value:{type:Object,default:()=>({})},networkOption:{type:Array,default:()=>[]},rows:{type:Array,default:()=>[]},mode:{type:String,default:"create"},isSingle:{type:Boolean,default:!0}},data(){const e=this.value.isPod;return e&&(this.value.networkName=g.PO),{isMasquerade:e,hasManagementNetwork:!1,showAdvanced:!1}},computed:{isDisabled(){return this.isMasquerade&&!this.value.newCreateId&&!this.isCreate},isView(){return this.mode===f.nW},isCreate(){return this.mode===f.YQ},modelOption(){return N},allNetworkOption(){const e=(0,y.o8)(this.networkOption),t=[{label:g.PO,value:g.PO}];return this.value.newCreateId&&this.hasManagementNetwork?e:this.value.newCreateId&&!this.hasManagementNetwork?[...t,...e]:this.isMasquerade?t:e},typeOption(){const e=[{label:"masquerade",value:"masquerade"},{label:"bridge",value:"bridge"}],t=[{label:"bridge",value:"bridge"}];return this.isMasquerade?e:t}},watch:{rows:{handler(e){const t=!!e.some((e=>e.isPod));this["hasManagementNetwork"]=t},immediate:!0,deep:!0},isSingle(e){e||(this.value["macAddress"]="",this.update())}},methods:{updateNetworkName(e){e===g.PO?(this.value.isPod=!0,this.value.macAddress=""):this.value.isPod=!1,this["isMasquerade"]=this.value.isPod,this.value.isPod?this.value.type="masquerade":this.value.type="bridge",this.update()},update(){this.$emit("update")},toggleAdvanced(){this.showAdvanced=!this.showAdvanced}}},w=a(47433);const V=(0,w.A)(k,[["render",p]]);var C=V},8746:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return k}});var s=a(9274);const o=e=>((0,s.pushScopeId)("data-v-697c87ca"),e=e(),(0,s.popScopeId)(),e),l=["onClick"],r=o((()=>(0,s.createElementVNode)("i",{class:"icon icon-x"},null,-1))),n=[r];function i(e,t,a,o,r,i){const d=(0,s.resolveComponent)("Base"),u=(0,s.resolveComponent)("InfoBox");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.rows,((t,o)=>((0,s.openBlock)(),(0,s.createBlock)(u,{key:o},{default:(0,s.withCtx)((()=>[i.isView?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:0,type:"button",class:"role-link remove-vol",onClick:e=>i.remove(t)},n,8,l)),(0,s.createElementVNode)("h3",null,(0,s.toDisplayString)(e.t("harvester.virtualMachine.network.title")),1),(0,s.createVNode)(d,{value:r.rows[o],"onUpdate:value":e=>r.rows[o]=e,rows:r.rows,mode:a.mode,"is-single":a.isSingle,"network-option":i.networkOption,onUpdate:i.update},null,8,["value","onUpdate:value","rows","mode","is-single","network-option","onUpdate"])])),_:2},1024)))),128)),i.isView?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:0,type:"button",class:"btn btn-sm bg-primary",onClick:t[0]||(t[0]=(...e)=>i.add&&i.add(...e))},(0,s.toDisplayString)(e.t("harvester.virtualMachine.network.addNetwork")),1))])}var d=a(26962),u=a(35664),c=a(74302),m=a(76978),p=a(92043),v=a(68851),h=a(14220),b=a(2602),y=a(48893),f={components:{InfoBox:d.A,Base:y["default"]},props:{mode:{type:String,default:"create"},value:{type:Array,default:()=>[]},isSingle:{type:Boolean,default:!0}},data(){return{rows:this.addKeyId((0,m.o8)(this.value)),nameIdx:1}},computed:{isView(){return this.mode===h.nW},networkOption(){const e=this.$store.getters["harvester/all"](u.XG).filter((e=>!e.metadata?.annotations?.[b.r.STORAGE_NETWORK])),t=(0,c.Ul)(e.map((e=>{const t=e.isNotReady?`${e.id} (${this.t("generic.notReady")})`:e.id;return{label:t,value:e.id,disabled:e.isNotReady}})),"label");return t}},watch:{value(e){this.rows=e}},methods:{add(e){const t=this.generateName(),a={name:t,networkName:"",model:"virtio",type:"bridge",newCreateId:(0,p.vx)(10),rowKeyId:(0,p.vx)(10)};this.rows.push(a),this.update()},remove(e){(0,v.Gj)(this.rows,e),this.update()},addKeyId(e){return e.map((e=>({...e,rowKeyId:(0,p.vx)(10)})))},generateName(){let e="",t=!0;while(t)e=`nic-${this.nameIdx}`,t=this.rows.find((t=>t.name===e)),this.nameIdx++;return e},update(){this.$emit("update:value",this.rows)}}},g=(a(89982),a(47433));const N=(0,g.A)(f,[["render",i],["__scopeId","data-v-697c87ca"]]);var k=N},78025:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var s=a(9274);function o(e,t,a,o,l,r){const n=(0,s.resolveComponent)("LabeledSelect"),i=(0,s.resolveComponent)("LabeledInput"),d=(0,s.resolveComponent)("ModalWithCard");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createVNode)(n,{value:l.checkedSsh,"onUpdate:value":[t[0]||(t[0]=e=>l.checkedSsh=e),r.update],label:e.t("harvester.virtualMachine.input.sshKey"),taggable:!0,mode:a.mode,multiple:!0,searchable:a.searchable,disabled:a.disabled,options:r.sshOption},null,8,["value","label","mode","searchable","disabled","options","onUpdate:value"]),l.isOpen?((0,s.openBlock)(),(0,s.createBlock)(d,{key:0,name:l.randomStr,width:"40%",errors:l.errors,onFinish:r.save,onClose:r.cancel},{title:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.t("harvester.virtualMachine.sshTitle")),1)])),content:(0,s.withCtx)((()=>[(0,s.createVNode)(i,{value:l.sshName,"onUpdate:value":t[1]||(t[1]=e=>l.sshName=e),label:e.t("harvester.virtualMachine.input.name"),class:"mb-20",required:"",onKeydown:t[2]||(t[2]=(0,s.withKeys)((0,s.withModifiers)((()=>{}),["prevent"]),["native","enter"]))},null,8,["value","label"]),(0,s.createVNode)(i,{value:l.publicKey,"onUpdate:value":t[3]||(t[3]=e=>l.publicKey=e),label:e.t("harvester.virtualMachine.input.sshKeyValue"),"min-height":160,class:"mb-20",type:"multiline",required:""},null,8,["value","label"])])),_:1},8,["name","errors","onFinish","onClose"])):(0,s.createCommentVNode)("",!0)])}var l=a(65359),r=a(92043),n=a(79380),i=a(40408),d=a(40973),u=a(76978),c=a(14220),m=a(35664),p=a(32766);const v="_NEW";var h={emits:["update:sshKey"],components:{LabeledInput:n.o,ModalWithCard:d.A,LabeledSelect:i.A},props:{value:{type:Array,default:()=>[]},mode:{type:String,default:"create"},disableCreate:{type:Boolean,default:!1},namespace:{type:String,default:""},createNamespace:{type:Boolean,default:!1},searchable:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},data(){return{checkedSsh:this.value,publicKey:"",sshName:"",randomStr:(0,r.vx)(5).toLowerCase(),errors:[],isAll:!1,checkAll:!1,isOpen:!1}},computed:{...(0,l.L8)({t:"i18n/t"}),schema(){return this.$store.getters["harvester/schemaFor"](p.rk.SSH)},isCreatable(){return!(this.schema&&!this.schema?.collectionMethods.find((e=>["blocked-post","post"].includes(e.toLowerCase()))))},sshOption(){const e=this.$store.getters["harvester/all"](p.rk.SSH).map((e=>({label:e.id,value:e.id})));return!this.disableCreate&&this.mode!==c.nW&&this.isCreatable&&e.unshift({label:this.t("harvester.virtualMachine.createSSHKey"),value:v}),e}},watch:{publicKey(e){const t=e.trim(),a=t.split(/\s+/);if(3===a.length&&!this.sshName){const e=a[2];this.randomStr=(0,r.vx)(10).toLowerCase(),this.sshName=e.includes("@")?e.split("@")[0]:e}},value(e){this.checkedSsh=e},checkedSsh(e,t){e.includes(v)&&(this["checkedSsh"]=t,this.update(),this.show())}},methods:{show(){this.isOpen=!0},hide(){this.isOpen=!1},async createNamespaceIfNeeded(){if(!this.createNamespace||this.disableCreate)return;const e=await this.$store.dispatch("harvester/findAll",{type:m.CU}),t=e?.find((e=>e.name===this.namespace));if(!t){const e=await this.$store.dispatch("harvester/createNamespace",{name:this.namespace},{root:!0});e.applyDefaults(),await e.save()}},async createSSHKey(){const e=await this.$store.dispatch("harvester/create",{metadata:{name:this.sshName,namespace:this.namespace},spec:{publicKey:this.publicKey},type:p.rk.SSH}),t=await e.save();t.id&&this.checkedSsh.push(`${this.namespace}/${this.sshName}`)},async save(e){if(this.errors=[],!this.sshName){const e=this.t("harvester.virtualMachine.input.name"),t=this.t("validation.required",{key:e});this.errors.push(t)}if(!this.publicKey){const e=this.t("harvester.virtualMachine.input.sshKeyValue"),t=this.t("validation.required",{key:e});this.errors.push(t)}if(this.sshName.length>63){const e=this.t("harvester.validation.custom.tooLongName",{max:63});this.errors.push(e)}if(this.errors.length>0)e(!1);else try{await this.createNamespaceIfNeeded(),await this.createSSHKey(),e(!0),this.cancel()}catch(t){this.errors=[t.message],e(!1)}},cancel(){this.hide(),this.resetFields()},resetFields(){this.sshName="",this.publicKey="",this.errors=[]},update(){this.$emit("update:sshKey",(0,u.o8)(this.checkedSsh))}}},b=a(47433);const y=(0,b.A)(h,[["render",o]]);var f=y},83141:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return G}});var s=a(9274);const o=e=>((0,s.pushScopeId)("data-v-16221464"),e=e(),(0,s.popScopeId)(),e),l=["onClick"],r=o((()=>(0,s.createElementVNode)("i",{class:"icon icon-x"},null,-1))),n=[r],i=["onClick"],d={key:0,class:"title"},u=["href"],c=o((()=>(0,s.createElementVNode)("i",{class:"icon icon-external-link"},null,-1))),m=[c],p={key:1},v={class:"bootOrder"},h={key:0,class:"mr-15"},b=["disabled","onClick"],y=o((()=>(0,s.createElementVNode)("i",{class:"icon icon-lg icon-chevron-up"},null,-1))),f=[y],g=["disabled","onClick"],N=o((()=>(0,s.createElementVNode)("i",{class:"icon icon-lg icon-chevron-down"},null,-1))),k=[N],w={class:"text-muted"},V={class:"mt-15"},C={key:2},E=["disabled"],U={class:"buttons"};function M(e,t,a,o,r,c){const y=(0,s.resolveComponent)("Banner"),N=(0,s.resolveComponent)("router-link"),M=(0,s.resolveComponent)("BadgeStateFormatter"),S=(0,s.resolveComponent)("InfoBox"),B=(0,s.resolveComponent)("Sortable"),x=(0,s.resolveComponent)("ModalWithCard"),I=(0,s.resolveDirective)("clean-tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[c.isView?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createBlock)(y,{key:0,color:"info","label-key":"harvester.virtualMachine.volume.dragTip"})),(0,s.createVNode)(B,{list:r.rows,options:{disabled:c.isView},"item-key":"id",onEnd:c.update},{item:(0,s.withCtx)((({element:t,index:o})=>[((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t.name},[(0,s.createVNode)(S,{class:"box"},{default:(0,s.withCtx)((()=>[c.isView?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:0,type:"button",class:"role-link btn btn-sm remove",onClick:e=>c.removeVolume(t)},n,8,l)),t.hotpluggable&&c.isView?((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:1,type:"button",class:"role-link btn remove",onClick:e=>c.unplugVolume(t)},(0,s.toDisplayString)(e.t("harvester.virtualMachine.unplug.detachVolume")),9,i)):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("h3",null,[t.to&&c.isVirtualType?((0,s.openBlock)(),(0,s.createElementBlock)("span",d,[(0,s.createVNode)(N,{to:t.to},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.t("harvester.virtualMachine.volume.edit"))+" "+(0,s.toDisplayString)(c.headerFor(t.source)),1)])),_:2},1032,["to"]),t.pvc?((0,s.openBlock)(),(0,s.createBlock)(M,{key:0,class:"ml-10 state",arbitrary:!0,row:t.pvc,value:t.pvc.state},null,8,["row","value"])):(0,s.createCommentVNode)("",!0),c.dev&&t.pvc&&t.pvc.resourceExternalLink?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("a",{key:1,class:"ml-5 resource-external",rel:"nofollow noopener noreferrer",target:"_blank",href:t.pvc.resourceExternalLink.url},m,8,u)),[[I,e.t(t.pvc.resourceExternalLink.tipsKey||"generic.resourceExternalLinkTips")]]):(0,s.createCommentVNode)("",!0)])):((0,s.openBlock)(),(0,s.createElementBlock)("span",p,(0,s.toDisplayString)(c.headerFor(t.source,!!t?.volumeBackups)),1))]),(0,s.createElementVNode)("div",null,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(c.componentFor(t.source)),{value:r.rows[o],rows:r.rows,namespace:a.namespace,"is-create":c.isCreate,"is-edit":c.isEdit,"is-view":c.isView,"is-virtual-type":c.isVirtualType,mode:a.mode,idx:o,"validate-required":a.validateRequired,onUpdate:c.update},null,40,["value","rows","namespace","is-create","is-edit","is-view","is-virtual-type","mode","idx","validate-required","onUpdate"]))]),(0,s.createElementVNode)("div",v,[c.isView?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",h,[(0,s.createElementVNode)("button",{disabled:0===o,class:"btn btn-sm role-primary",onClick:(0,s.withModifiers)((e=>c.changeSort(o,!1)),["prevent"])},f,8,b),(0,s.createElementVNode)("button",{disabled:o===r.rows.length-1,class:"btn btn-sm role-primary",onClick:(0,s.withModifiers)((e=>c.changeSort(o,!0)),["prevent"])},k,8,g)])),(0,s.createElementVNode)("div",w," bootOrder: "+(0,s.toDisplayString)(o+1),1)]),(0,s.createElementVNode)("div",V,[t.volumeStatus&&!c.isCreate?((0,s.openBlock)(),(0,s.createBlock)(y,{key:0,class:"volume-status",color:"warning",label:r.ucFirst(t.volumeStatus)},null,8,["label"])):(0,s.createCommentVNode)("",!0),a.value.volumeBackups&&a.value.volumeBackups.error&&a.value.volumeBackups.error.message?((0,s.openBlock)(),(0,s.createBlock)(y,{key:1,color:"error",label:r.ucFirst(a.value.volumeBackups.error.message)},null,8,["label"])):(0,s.createCommentVNode)("",!0),c.isLonghornV2(t)&&!c.isView?((0,s.openBlock)(),(0,s.createBlock)(y,{key:2,color:"warning",label:e.t("harvester.volume.longhorn.disableResize")},null,8,["label"])):(0,s.createCommentVNode)("",!0)])])),_:2},1024)]))])),_:1},8,["list","options","onEnd"]),c.showVolumeTip?((0,s.openBlock)(),(0,s.createBlock)(y,{key:1,color:"warning",label:e.t("harvester.virtualMachine.volume.volumeTip")},null,8,["label"])):(0,s.createCommentVNode)("",!0),c.isView?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",C,[(0,s.createElementVNode)("button",{type:"button",class:"btn btn-sm bg-primary mr-15 mb-10",disabled:0===r.rows.length,onClick:t[0]||(t[0]=e=>c.addVolume(r.SOURCE_TYPE.NEW))},(0,s.toDisplayString)(e.t("harvester.virtualMachine.volume.addVolume")),9,E),a.existingVolumeDisabled?(0,s.createCommentVNode)("",!0):((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:0,type:"button",class:"btn btn-sm bg-primary mr-15 mb-10",onClick:t[1]||(t[1]=e=>c.addVolume(r.SOURCE_TYPE.ATTACH_VOLUME))},(0,s.toDisplayString)(e.t("harvester.virtualMachine.volume.addExistingVolume")),1)),(0,s.createElementVNode)("button",{type:"button",class:"btn btn-sm bg-primary mr-15 mb-10",onClick:t[2]||(t[2]=e=>c.addVolume(r.SOURCE_TYPE.IMAGE))},(0,s.toDisplayString)(e.t("harvester.virtualMachine.volume.addVmImage")),1),(0,s.createElementVNode)("button",{type:"button",class:"btn btn-sm bg-primary mb-10",onClick:t[3]||(t[3]=e=>c.addVolume(r.SOURCE_TYPE.CONTAINER))},(0,s.toDisplayString)(e.t("harvester.virtualMachine.volume.addContainer")),1)])),r.isOpen?((0,s.openBlock)(),(0,s.createBlock)(x,{key:3,name:"deleteTip",width:400},{title:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.t("harvester.virtualMachine.volume.unmount.title")),1)])),content:(0,s.withCtx)((()=>[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(e.t("harvester.virtualMachine.volume.unmount.message")),1)])),footer:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",U,[(0,s.createElementVNode)("button",{class:"btn role-secondary mr-20",onClick:t[4]||(t[4]=(0,s.withModifiers)(((...e)=>c.cancel&&c.cancel(...e)),["prevent"]))},(0,s.toDisplayString)(e.t("generic.no")),1),(0,s.createElementVNode)("button",{class:"btn bg-primary mr-20",onClick:t[5]||(t[5]=(0,s.withModifiers)(((...e)=>c.deleteVolume&&c.deleteVolume(...e)),["prevent"]))},(0,s.toDisplayString)(e.t("generic.yes")),1)])])),_:1})):(0,s.createCommentVNode)("",!0)])}var S=a(48052),B=a(26962),x=a(9980),I=a(74562),A=a(84215),T=a(79380),O=a(40408),_=a(40973),L=a(35664),$=a(76978),D=a(92043),q=a(68851),P=a(14220),R=a(91462),K=a(66905),z=a(20652),H=a(32766),F={emits:["update:value"],components:{Banner:x.l,BadgeStateFormatter:I.A,Sortable:S.L,InfoBox:B.A,LabeledInput:T.o,UnitInput:A.A,LabeledSelect:O.A,ModalWithCard:_.A},props:{vm:{type:Object,default:()=>({})},mode:{type:String,default:P.YQ},value:{type:Array,default:()=>[]},namespace:{type:String,default:null},existingVolumeDisabled:{type:Boolean,default:!1},validateRequired:{type:Boolean,default:!1},customVolumeMode:{type:String,default:"Block"},customAccessMode:{type:String,default:"ReadWriteMany"},resourceType:{type:String,default:""}},async fetch(){await this.$store.dispatch("harvester/findAll",{type:L.YH})},data(){return{ucFirst:D.TF,SOURCE_TYPE:K.xO,rows:(0,$.o8)(this.value),nameIdx:1,vol:null,isOpen:!1}},computed:{dev(){try{return this.$store.getters["prefs/get"](R.bc)}catch{return this.$store.getters["prefs/get"](R.IJ)}},isVirtualType(){return this.resourceType===H.rk.VM},isView(){return this.mode===P.nW},isEdit(){return this.mode===P.G5},isCreate(){return this.mode===P.YQ},showVolumeTip(){const e=this.getImageDisplayName(this.rows[0]?.image);return!(1!==this.rows.length||"cd-rom"!==this.rows[0].type||!/.iso$/i.test(e))},pvcs(){return this.$store.getters["harvester/all"](L.YH)||[]}},watch:{value:{handler(e){const t=(0,$.o8)(e).map((e=>(this.isCreate||e.source===K.xO.CONTAINER||e.newCreateId||(e.to={name:`${z.KR}-c-cluster-resource-namespace-id`,params:{resource:H.rk.VOLUME,namespace:this.namespace,id:e.realName},query:{mode:P.G5}},e.pvc=this.pvcs.find((t=>t.metadata.name===e.realName))),e)));this["rows"]=t},deep:!0,immediate:!0}},methods:{addVolume(e){const t=this.generateName(),a={id:(0,D.vx)(5),name:t,source:e,size:"10Gi",type:"disk",accessMode:this.customAccessMode,volumeMode:this.customVolumeMode,volumeName:"",bus:"virtio",newCreateId:(0,D.vx)(10)};e===K.xO.NEW&&(a.storageClassName=this.defaultStorageClass?.metadata?.name||"longhorn"),this.rows.push(a),this.update()},generateName(){let e="",t=!0;while(t)e=`disk-${this.nameIdx}`,t=this.rows.find((t=>t.name===e)),this.nameIdx++;return e},removeVolume(e){this.vol=e,!e.newCreateId&&this.isEdit&&this.isVirtualType?this.isOpen=!0:((0,q.Gj)(this.rows,e),this.update())},unplugVolume(e){this.vm.unplugVolume(e.name)},componentFor(e){switch(e){case K.xO.NEW:return a(18693)["default"];case K.xO.IMAGE:return a(95394)["default"];case K.xO.ATTACH_VOLUME:return a(40090)["default"];case K.xO.CONTAINER:return a(88656)["default"]}},headerFor(e,t=!1){const a={[K.xO.NEW]:this.$store.getters["i18n/t"]("harvester.virtualMachine.volume.title.volume"),[K.xO.IMAGE]:this.$store.getters["i18n/t"]("harvester.virtualMachine.volume.title.vmImage"),[K.xO.ATTACH_VOLUME]:this.$store.getters["i18n/t"]("harvester.virtualMachine.volume.title.existingVolume"),[K.xO.CONTAINER]:this.$store.getters["i18n/t"]("harvester.virtualMachine.volume.title.container")}[e];return t?`${a} and Backups`:a},update(){this.$emit("update:value",this.rows)},deleteVolume(){(0,q.Gj)(this.rows,this.vol),this.update(),this.cancel()},cancel(){this.isOpen=!1},changeSort(e,t){this.rows.splice(t?e:e-1,1,...this.rows.splice(t?e+1:e,1,this.rows[t?e:e-1])),this.update()},getImageDisplayName(e){return this.$store.getters["harvester/all"](H.rk.IMAGE).find((t=>t.id===e))?.spec?.displayName},isLonghornV2(e){return e?.pvc?.isLonghornV2||e?.pvc?.storageClass?.isLonghornV2}}},W=(a(32298),a(47433));const j=(0,W.A)(F,[["render",M],["__scopeId","data-v-16221464"]]);var G=j},88656:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return k}});var s=a(9274);const o={class:"row mb-20"},l={"data-testid":"input-hec-name",class:"col span-6"},r={"data-testid":"input-hec-type",class:"col span-6"},n={class:"row mb-20"},i={"data-testid":"input-hec-container",class:"col span-6"},d={"data-testid":"input-hec-bus",class:"col span-6"},u={class:"row mb-20"},c={key:0,class:"col span-6"};function m(e,t,a,m,p,v){const h=(0,s.resolveComponent)("LabeledInput"),b=(0,s.resolveComponent)("InputOrDisplay"),y=(0,s.resolveComponent)("LabeledSelect"),f=(0,s.resolveComponent)("LabelValue"),g=(0,s.resolveComponent)("Banner");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",o,[(0,s.createElementVNode)("div",l,[(0,s.createVNode)(b,{name:e.t("harvester.fields.name"),value:a.value.name,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(h,{value:a.value.name,"onUpdate:value":[t[0]||(t[0]=e=>a.value.name=e),v.update],label:e.t("harvester.fields.name"),required:"",mode:a.mode},null,8,["value","label","mode","onUpdate:value"])])),_:1},8,["name","value","mode"])]),(0,s.createElementVNode)("div",r,[(0,s.createVNode)(b,{name:e.t("harvester.fields.type"),value:a.value.type,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(y,{value:a.value.type,"onUpdate:value":[t[1]||(t[1]=e=>a.value.type=e),v.update],label:e.t("harvester.fields.type"),options:p.VOLUME_TYPE,mode:a.mode,required:""},null,8,["value","label","options","mode","onUpdate:value"])])),_:1},8,["name","value","mode"])])]),(0,s.createElementVNode)("div",n,[(0,s.createElementVNode)("div",i,[(0,s.createVNode)(b,{name:e.t("harvester.virtualMachine.volume.dockerImage"),value:a.value.container,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(h,{value:a.value.container,"onUpdate:value":[t[2]||(t[2]=e=>a.value.container=e),v.update],label:e.t("harvester.virtualMachine.volume.dockerImage"),mode:a.mode,required:""},null,8,["value","label","mode","onUpdate:value"])])),_:1},8,["name","value","mode"])]),(0,s.createElementVNode)("div",d,[(0,s.createVNode)(b,{name:e.t("harvester.virtualMachine.volume.bus"),value:a.value.bus,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(y,{value:a.value.bus,"onUpdate:value":[t[3]||(t[3]=e=>a.value.bus=e),v.update],label:e.t("harvester.virtualMachine.volume.bus"),options:p.InterfaceOption,mode:a.mode},null,8,["value","label","options","mode","onUpdate:value"])])),_:1},8,["name","value","mode"])])]),(0,s.createElementVNode)("div",u,[a.value.volumeBackups?((0,s.openBlock)(),(0,s.createElementBlock)("div",c,[(0,s.createVNode)(b,{name:e.t("harvester.virtualMachine.volume.readyToUse"),value:a.value.volumeBackups.readyToUse,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(f,{name:e.t("harvester.virtualMachine.volume.readyToUse"),value:a.value.volumeBackups.readyToUse},null,8,["name","value"])])),_:1},8,["name","value","mode"])])):(0,s.createCommentVNode)("",!0)]),a.value.volumeBackups&&a.value.volumeBackups.error&&a.value.volumeBackups.error.message?((0,s.openBlock)(),(0,s.createBlock)(g,{key:0,color:"error",class:"mb-20",label:a.value.volumeBackups.error.message},null,8,["label"])):(0,s.createCommentVNode)("",!0)])}var p=a(79380),v=a(40408),h=a(60090),b=a(66905),y=a(9980),f={name:"HarvesterEditContainer",emits:["update"],components:{LabeledInput:p.o,LabeledSelect:v.A,InputOrDisplay:h.A,Banner:y.l},props:{mode:{type:String,default:"create"},value:{type:Object,required:!0}},data(){return{VOLUME_TYPE:b._w,InterfaceOption:b.$z}},watch:{"value.type"(e){"cd-rom"===e&&(this.value["bus"]="sata",this.update())}},methods:{update(){this.$emit("update")}}},g=a(47433);const N=(0,g.A)(f,[["render",m]]);var k=N},40090:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var s=a(9274);const o={class:"row mb-20"},l={"data-testid":"input-hee-name",class:"col span-6"},r={"data-testid":"input-hee-type",class:"col span-6"},n={class:"row mb-20"},i={"data-testid":"input-hee-volumeName",class:"col span-6"},d={"data-testid":"input-hee-size",class:"col span-6"},u={class:"row mb-20"},c={key:0,"data-testid":"input-hee-image",class:"col span-6"},m={"data-testid":"input-hee-bus",class:"col span-6"},p={key:1,class:"col span-6"};function v(e,t,a,v,h,b){const y=(0,s.resolveComponent)("LabeledInput"),f=(0,s.resolveComponent)("InputOrDisplay"),g=(0,s.resolveComponent)("LabeledSelect"),N=(0,s.resolveComponent)("UnitInput"),k=(0,s.resolveComponent)("LabelValue"),w=(0,s.resolveComponent)("Banner");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",o,[(0,s.createElementVNode)("div",l,[(0,s.createVNode)(f,{name:e.t("harvester.fields.name"),value:a.value.name,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(y,{value:a.value.name,"onUpdate:value":[t[0]||(t[0]=e=>a.value.name=e),b.update],label:e.t("harvester.fields.name"),mode:a.mode,required:""},null,8,["value","label","mode","onUpdate:value"])])),_:1},8,["name","value","mode"])]),(0,s.createElementVNode)("div",r,[(0,s.createVNode)(f,{name:e.t("harvester.fields.type"),value:a.value.type,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(g,{value:a.value.type,"onUpdate:value":[t[1]||(t[1]=e=>a.value.type=e),b.update],label:e.t("harvester.fields.type"),mode:a.mode,options:h.VOLUME_TYPE,required:""},null,8,["value","label","mode","options","onUpdate:value"])])),_:1},8,["name","value","mode"])])]),(0,s.createElementVNode)("div",n,[(0,s.createElementVNode)("div",i,[(0,s.createVNode)(f,{name:e.t("harvester.fields.volume"),value:a.value.volumeName,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(g,{value:a.value.volumeName,"onUpdate:value":[t[2]||(t[2]=e=>a.value.volumeName=e),b.update],disabled:b.isDisabled,label:e.t("harvester.fields.volume"),mode:a.mode,options:b.volumeOption,required:""},null,8,["value","disabled","label","mode","options","onUpdate:value"])])),_:1},8,["name","value","mode"])]),(0,s.createElementVNode)("div",d,[(0,s.createVNode)(f,{name:e.t("harvester.fields.size"),value:a.value.size,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(N,{value:a.value.size,"onUpdate:value":[t[3]||(t[3]=e=>a.value.size=e),b.update],"output-modifier":!0,increment:1024,"input-exponent":3,label:e.t("harvester.fields.size"),mode:a.mode,disabled:!0},null,8,["value","label","mode","onUpdate:value"])])),_:1},8,["name","value","mode"])])]),(0,s.createElementVNode)("div",u,[b.image?((0,s.openBlock)(),(0,s.createElementBlock)("div",c,[(0,s.createVNode)(f,{name:e.t("harvester.fields.image"),value:b.image,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(y,{value:b.image,"onUpdate:value":[t[4]||(t[4]=e=>b.image=e),b.update],label:e.t("harvester.fields.image"),mode:a.mode,disabled:!0},null,8,["value","label","mode","onUpdate:value"])])),_:1},8,["name","value","mode"])])):(0,s.createCommentVNode)("",!0),(0,s.createElementVNode)("div",m,[(0,s.createVNode)(f,{name:e.t("harvester.virtualMachine.volume.bus"),value:a.value.bus,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(g,{value:a.value.bus,"onUpdate:value":[t[5]||(t[5]=e=>a.value.bus=e),b.update],label:e.t("harvester.virtualMachine.volume.bus"),mode:a.mode,options:h.InterfaceOption,disabled:!0,required:""},null,8,["value","label","mode","options","onUpdate:value"])])),_:1},8,["name","value","mode"])]),a.value.volumeBackups?((0,s.openBlock)(),(0,s.createElementBlock)("div",p,[(0,s.createVNode)(f,{name:e.t("harvester.virtualMachine.volume.readyToUse"),value:a.value.volumeBackups.readyToUse,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(k,{name:e.t("harvester.virtualMachine.volume.readyToUse"),value:a.value.volumeBackups.readyToUse},null,8,["name","value"])])),_:1},8,["name","value","mode"])])):(0,s.createCommentVNode)("",!0)]),a.value.volumeBackups&&a.value.volumeBackups.error&&a.value.volumeBackups.error.message?((0,s.openBlock)(),(0,s.createBlock)(w,{key:0,color:"error",class:"mb-20",label:a.value.volumeBackups.error.message},null,8,["label"])):(0,s.createCommentVNode)("",!0)])}var h=a(84215),b=a(79380),y=a(39412),f=a(40408),g=a(60090),N=a(9980),k=a(74302),w=a(35664),V=a(14220),C=a(2602),E=a(32766),U=a(66905),M={name:"HarvesterEditExisting",emits:["update"],components:{UnitInput:h.A,LabeledInput:b.o,LabeledSelect:f.A,InputOrDisplay:g.A,LabelValue:y.A,Banner:N.l},props:{mode:{type:String,default:V.YQ},value:{type:Object,required:!0},isEdit:{type:Boolean,default:!1},namespace:{type:String,default:null},idx:{type:Number,default:0},rows:{type:Array,required:!0}},data(){return this.value.realName&&(this.value.volumeName=this.value.realName),{VOLUME_TYPE:U._w,InterfaceOption:U.$z,loading:!1}},computed:{isDisabled(){return!this.value.newCreateId&&this.isEdit},allPVCs(){const e=this.$store.getters["harvester/all"](w.YH);return e.filter((e=>!this.namespace||this.namespace===e.metadata.namespace))||[]},image(){const e=this.$store.getters["harvester/all"](E.rk.IMAGE).find((e=>e.id===this.pvcResource?.metadata?.annotations?.[C.r.IMAGE_ID]));if(e)return`${e.metadata.namespace}/${e.spec.displayName}`},pvcResource(){return this.allPVCs.find((e=>e.metadata.name===this.value.volumeName))},volumeOption(){return(0,k.Ul)(this.allPVCs.filter((e=>{let t=!0,a=!1;return this.rows.forEach((a=>{a.volumeName===e.metadata.name&&(t=!1)})),!(0===this.idx&&!e.metadata?.annotations?.[C.r.IMAGE_ID])&&(e.attachVM&&t&&e.attachVM?.id===this.vm?.id&&this.isEdit?a=!1:e.attachVM&&(a=!0),t&&!a&&e.isAvailable)})).map((e=>({label:e.metadata.name,value:e.metadata.name}))),"label")}},watch:{"value.volumeName"(e){const t=this.allPVCs.find((t=>t.metadata.name===e));t&&(this.value.accessModes=t.spec.accessModes[0],this.value.size=t.spec.resources.requests.storage,this.value.storageClassName=t.spec.storageClassName,this.value.volumeMode=t.spec.volumeMode)},"value.type"(e){"cd-rom"===e&&(this.value["bus"]="sata",this.update())},pvcResource:{handler(e){!this.value.volumeName&&e?.metadata?.name&&(this.value.volumeName=e.metadata.name)},deep:!0,immediate:!0}},methods:{update(){this.$emit("update")}}},S=a(47433);const B=(0,S.A)(M,[["render",v]]);var x=B},95394:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return A}});var s=a(9274);const o={class:"row mb-20"},l={"data-testid":"input-hevi-name",class:"col span-6"},r={"data-testid":"input-hevi-type",class:"col span-6"},n={class:"row mb-20"},i={"data-testid":"input-hevi-image",class:"col span-6"},d={"data-testid":"input-hevi-size",class:"col span-6"},u={class:"row mb-20"},c={"data-testid":"input-hevi-bus",class:"col span-6"},m={key:0,class:"col span-3"},p={class:"row mb-20"},v={key:0,class:"col span-3"};function h(e,t,a,h,b,y){const f=(0,s.resolveComponent)("LabeledInput"),g=(0,s.resolveComponent)("InputOrDisplay"),N=(0,s.resolveComponent)("LabeledSelect"),k=(0,s.resolveComponent)("UnitInput"),w=(0,s.resolveComponent)("LabelValue"),V=(0,s.resolveComponent)("Banner");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",o,[(0,s.createElementVNode)("div",l,[(0,s.createVNode)(g,{name:e.t("harvester.fields.name"),value:a.value.name,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(f,{value:a.value.name,"onUpdate:value":[t[0]||(t[0]=e=>a.value.name=e),y.update],label:e.t("harvester.fields.name"),required:"",mode:a.mode},null,8,["value","label","mode","onUpdate:value"])])),_:1},8,["name","value","mode"])]),(0,s.createElementVNode)("div",r,[(0,s.createVNode)(g,{name:e.t("harvester.fields.type"),value:a.value.type,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(N,{value:a.value.type,"onUpdate:value":[t[1]||(t[1]=e=>a.value.type=e),y.update],label:e.t("harvester.fields.type"),options:b.VOLUME_TYPE,mode:a.mode},null,8,["value","label","options","mode","onUpdate:value"])])),_:1},8,["name","value","mode"])])]),(0,s.createElementVNode)("div",n,[(0,s.createElementVNode)("div",i,[(0,s.createVNode)(g,{name:e.t("harvester.fields.image"),value:y.imageName,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(N,{value:a.value.image,"onUpdate:value":[t[2]||(t[2]=e=>a.value.image=e),y.onImageChange],disabled:0===a.idx&&!a.isCreate&&!a.value.newCreateId&&a.isVirtualType,label:e.t("harvester.fields.image"),options:y.imagesOption,mode:a.mode,searchable:!0,required:a.validateRequired},null,8,["value","disabled","label","options","mode","required","onUpdate:value"])])),_:1},8,["name","value","mode"])]),(0,s.createElementVNode)("div",d,[(0,s.createVNode)(g,{name:e.t("harvester.fields.size"),value:a.value.size,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(k,{value:a.value.size,"onUpdate:value":[t[3]||(t[3]=e=>a.value.size=e),y.update],"output-modifier":!0,increment:1024,"input-exponent":3,label:e.t("harvester.fields.size"),mode:a.mode,required:a.validateRequired,disable:y.isLonghornV2,suffix:"GiB"},null,8,["value","label","mode","required","disable","onUpdate:value"])])),_:1},8,["name","value","mode"])])]),(0,s.createElementVNode)("div",u,[(0,s.createElementVNode)("div",c,[(0,s.createVNode)(g,{name:e.t("harvester.virtualMachine.volume.bus"),value:a.value.bus,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(N,{value:a.value.bus,"onUpdate:value":[t[4]||(t[4]=e=>a.value.bus=e),y.update],label:e.t("harvester.virtualMachine.volume.bus"),mode:a.mode,options:b.InterfaceOption},null,8,["value","label","mode","options","onUpdate:value"])])),_:1},8,["name","value","mode"])]),a.value.volumeEncryptionFeatureEnabled&&y.isView?((0,s.openBlock)(),(0,s.createElementBlock)("div",m,[(0,s.createVNode)(w,{name:e.t("harvester.virtualMachine.volume.encryption"),value:y.encryptionValue},null,8,["name","value"])])):(0,s.createCommentVNode)("",!0)]),(0,s.createElementVNode)("div",p,[a.value.volumeBackups&&y.isView?((0,s.openBlock)(),(0,s.createElementBlock)("div",v,[(0,s.createVNode)(w,{name:e.t("harvester.virtualMachine.volume.readyToUse"),value:y.readyToUse},null,8,["name","value"])])):(0,s.createCommentVNode)("",!0)]),a.value.volumeBackups&&a.value.volumeBackups.error&&a.value.volumeBackups.error.message?((0,s.openBlock)(),(0,s.createBlock)(V,{key:0,color:"error",class:"mb-20",label:a.value.volumeBackups.error.message},null,8,["label"])):(0,s.createCommentVNode)("",!0)])}var b=a(68851),y=a(84215),f=a(79380),g=a(40408),N=a(60090),k=a(9980),w=a(35664),V=a(95799),C=a(32766),E=a(66905),U=a(14220),M=a(39412),S=a(92043),B={name:"HarvesterEditVMImage",emits:["update"],components:{UnitInput:y.A,LabeledInput:f.o,LabeledSelect:g.A,InputOrDisplay:N.A,LabelValue:M.A,Banner:k.l},props:{value:{type:Object,default:()=>({})},namespace:{type:String,default:null},mode:{type:String,default:"create"},idx:{type:Number,required:!0},isCreate:{type:Boolean,default:!0},isEdit:{type:Boolean,default:!1},validateRequired:{type:Boolean,required:!0},isVirtualType:{type:Boolean,default:!0}},data(){return{VOLUME_TYPE:E._w,InterfaceOption:E.$z,loading:!1,images:[]}},fetch(){this.images=this.$store.getters["harvester/all"](C.rk.IMAGE)},computed:{encryptionValue(){return(0,S.TF)(String(this.value.isEncrypted))},isView(){return this.mode===U.nW},imagesOption(){return this.images.filter((e=>e.isReady)).sort(((e,t)=>e.creationTimestamp>t.creationTimestamp?-1:1)).map((e=>({label:`${e.metadata.namespace}/${e.spec.displayName}`,value:e.id})))},imageName(){const e=this.imagesOption.find((e=>e.value===this.value.image));return e?e.label:"-"},readyToUse(){const e=String(this.value.volumeBackups?.readyToUse||!1);return(0,S.TF)(e)},pvcsResource(){const e=this.$store.getters["harvester/all"](w.YH)||[];return e.find((e=>!this.namespace||e.id===`${this.namespace}/${this.value.volumeName}`))},isLonghornV2(){return this.value.pvc?.isLonghornV2||this.value.pvc?.storageClass?.isLonghornV2}},watch:{"value.type"(e){"cd-rom"===e&&(this.value["bus"]="sata",this.update())},"value.image"(e){this.checkImageExists(e)},imagesOption(){this.checkImageExists(this.value.image)},pvcsResource:{handler(e){if(e?.spec?.resources?.requests?.storage&&this.isVirtualType){const t=(0,V.ao)(e.spec.resources.requests.storage),a=(0,V.Mo)(t,{increment:1024,addSuffix:!1,maxExponent:3,minExponent:3});this.value.size=`${a}Gi`}},deep:!0,immediate:!0}},methods:{update(){this.$emit("update")},onImageChange(){const e=this.$store.getters["harvester/all"](C.rk.IMAGE)?.find((e=>this.value.image===e.id)),t=/iso$/i.test(e?.imageSuffix),a=Math.max(e?.status?.size,e?.status?.virtualSize);if(t?(this.value["type"]="cd-rom",this.value["bus"]="sata"):(this.value["type"]="disk",this.value["bus"]="virtio"),a){let e=Math.ceil(a/1024/1024/1024);t||(e=Math.max(e,10)),this.value["size"]=`${e}Gi`}this.update()},onOpen(){this.images=this.$store.getters["harvester/all"](C.rk.IMAGE)},checkImageExists(e){e&&this.imagesOption.length>0&&!(0,b.jq)(this.imagesOption,"value",e)&&(this.$store.dispatch("growl/error",{title:this.$store.getters["i18n/t"]("harvester.vmTemplate.tips.notExistImage.title",{name:e}),message:this.$store.getters["i18n/t"]("harvester.vmTemplate.tips.notExistImage.message")},{root:!0}),this.value["image"]="")}}},x=a(47433);const I=(0,x.A)(B,[["render",h]]);var A=I},18693:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return A}});var s=a(9274);const o={class:"row mb-20"},l={class:"col span-6","data-testid":"input-hev-name"},r={class:"col span-6","data-testid":"input-hev-type"},n={class:"row mb-20"},i={"data-testid":"input-hav-storage",class:"col span-6"},d={class:"col span-6","data-testid":"input-hev-size"},u={class:"row mb-20"},c={"data-testid":"input-hev-bus",class:"col span-6"},m={key:0,class:"col span-6"},p={class:"row mb-20"},v={key:0,class:"col span-3"};function h(e,t,a,h,b,y){const f=(0,s.resolveComponent)("Loading"),g=(0,s.resolveComponent)("LabeledInput"),N=(0,s.resolveComponent)("InputOrDisplay"),k=(0,s.resolveComponent)("LabeledSelect"),w=(0,s.resolveComponent)("UnitInput"),V=(0,s.resolveComponent)("LabelValue");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createVNode)(f,{mode:"relative",loading:b.loading},null,8,["loading"]),(0,s.createElementVNode)("div",o,[(0,s.createElementVNode)("div",l,[(0,s.createVNode)(N,{name:e.t("harvester.fields.name"),value:a.value.name,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(g,{value:a.value.name,"onUpdate:value":[t[0]||(t[0]=e=>a.value.name=e),y.update],label:e.t("harvester.fields.name"),mode:a.mode,required:""},null,8,["value","label","mode","onUpdate:value"])])),_:1},8,["name","value","mode"])]),(0,s.createElementVNode)("div",r,[(0,s.createVNode)(N,{name:e.t("harvester.fields.type"),value:a.value.type,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(k,{value:a.value.type,"onUpdate:value":[t[1]||(t[1]=e=>a.value.type=e),y.update],label:e.t("harvester.fields.type"),options:b.VOLUME_TYPE,required:"",mode:a.mode},null,8,["value","label","options","mode","onUpdate:value"])])),_:1},8,["name","value","mode"])])]),(0,s.createElementVNode)("div",n,[(0,s.createElementVNode)("div",i,[(0,s.createVNode)(N,{name:e.t("harvester.storage.storageClass.label"),value:a.value.storageClassName,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(k,{value:a.value.storageClassName,"onUpdate:value":[t[2]||(t[2]=e=>a.value.storageClassName=e),y.update],options:y.storageClassOptions,label:e.t("harvester.storage.storageClass.label"),mode:a.mode,disabled:y.isDisabled,required:a.validateRequired},null,8,["value","options","label","mode","disabled","required","onUpdate:value"])])),_:1},8,["name","value","mode"])]),(0,s.createElementVNode)("div",d,[(0,s.createVNode)(N,{name:e.t("harvester.fields.size"),value:a.value.size,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(w,{value:a.value.size,"onUpdate:value":[t[3]||(t[3]=e=>a.value.size=e),y.update],"output-modifier":!0,increment:1024,"input-exponent":3,mode:a.mode,required:a.validateRequired,label:e.t("harvester.fields.size"),disabled:y.isLonghornV2},null,8,["value","mode","required","label","disabled","onUpdate:value"])])),_:1},8,["name","value","mode"])])]),(0,s.createElementVNode)("div",u,[(0,s.createElementVNode)("div",c,[(0,s.createVNode)(N,{name:e.t("harvester.virtualMachine.volume.bus"),value:a.value.bus,mode:a.mode},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(k,{value:a.value.bus,"onUpdate:value":[t[4]||(t[4]=e=>a.value.bus=e),y.update],label:e.t("harvester.virtualMachine.volume.bus"),mode:a.mode,options:b.InterfaceOption,required:""},null,8,["value","label","mode","options","onUpdate:value"])])),_:1},8,["name","value","mode"])]),a.value.volumeEncryptionFeatureEnabled&&y.isView?((0,s.openBlock)(),(0,s.createElementBlock)("div",m,[(0,s.createVNode)(V,{name:e.t("harvester.virtualMachine.volume.encryption"),value:y.encryptionValue},null,8,["name","value"])])):(0,s.createCommentVNode)("",!0)]),(0,s.createElementVNode)("div",p,[a.value.volumeBackups&&y.isView?((0,s.openBlock)(),(0,s.createElementBlock)("div",v,[(0,s.createVNode)(V,{name:e.t("harvester.virtualMachine.volume.readyToUse"),value:y.readyToUse},null,8,["name","value"])])):(0,s.createCommentVNode)("",!0)])])}var b=a(84409),y=a(84215),f=a(60090),g=a(79380),N=a(40408),k=a(35664),w=a(95799),V=a(66905),C=a(14220),E=a(39412),U=a(92043),M=a(82877),S=a(15908),B={name:"HarvesterEditVolume",emits:["update"],components:{InputOrDisplay:f.A,Loading:b.A,LabeledInput:g.o,LabeledSelect:N.A,UnitInput:y.A,LabelValue:E.A},props:{mode:{type:String,default:"create"},isEdit:{type:Boolean,default:!1},namespace:{type:String,default:null},value:{type:Object,default:()=>({})},validateRequired:{type:Boolean,required:!0},isVirtualType:{type:Boolean,default:!0}},data(){return{VOLUME_TYPE:V._w,InterfaceOption:V.$z,loading:!1}},computed:{longhornV2LVMSupport(){return this.$store.getters["harvester-common/getFeatureEnabled"]("longhornV2LVMSupport")},encryptionValue(){return(0,U.TF)(String(this.value.isEncrypted))},readyToUse(){const e=String(this.value.volumeBackups?.readyToUse||!1);return(0,U.TF)(e)},isView(){return this.mode===C.nW},pvcsResource(){const e=this.$store.getters["harvester/all"](k.YH)||[];return e.find((e=>e.id===`${this.namespace}/${this.value.volumeName}`))},isDisabled(){return!this.value.newCreateId&&this.isEdit&&this.isVirtualType},storageClasses(){return this.$store.getters["harvester/all"](k.fJ)||[]},storageClassOptions(){return this.storageClasses.filter((e=>!e.parameters?.backingImage)).map((e=>{const t=e.isDefault?`${e.name} (${this.t("generic.default")})`:e.name;return{label:t,value:e.name}}))||[]},isLonghornV2(){return this.value.pvc?.isLonghornV2||this.value.pvc?.storageClass?.isLonghornV2}},watch:{"value.storageClassName":{immediate:!0,handler(e){this.value.accessMode=this.getAccessMode(e)}},"value.type"(e){"cd-rom"===e&&(this.value["bus"]="sata",this.update())},pvcsResource:{handler(e){if(e?.spec?.resources?.requests?.storage){const t=(0,w.ao)(e.spec.resources.requests.storage),a=(0,w.Mo)(t,{increment:1024,addSuffix:!1,maxExponent:3,minExponent:3});this.value.size=`${a}Gi`}},deep:!0,immediate:!0}},methods:{getAccessMode(e){if(!this.longhornV2LVMSupport)return"ReadWriteMany";const t=this.storageClasses.find((t=>t.name===e));let a=this.value.pvc?.isLvm||this.value.pvc?.isLonghornV2;return t&&(a=t.provisioner===M.LVM_DRIVER||t.parameters?.dataEngine===S.DATA_ENGINE_V2),a?"ReadWriteOnce":"ReadWriteMany"},update(){this.$emit("update")}}},x=a(47433);const I=(0,x.A)(B,[["render",h]]);var A=I},19044:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),l=a(40935),r=a.n(l),n=r()(o());n.push([e.id,".vm__credentials-users .hasUsers.labeled-select.edit.taggable .labeled-tooltip .icon.status-icon{top:30px}",""]),t["default"]=n},67647:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),l=a(40935),r=a.n(l),n=r()(o());n.push([e.id,".volume-source[data-v-61977bc4]{position:relative}.remove-vol[data-v-61977bc4]{position:absolute;top:10px;right:10px;padding:0}",""]),t["default"]=n},34213:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),l=a(40935),r=a.n(l),n=r()(o());n.push([e.id,".action[data-v-7d19b7bd]{display:flex;flex-direction:row-reverse}",""]),t["default"]=n},67381:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),l=a(40935),r=a.n(l),n=r()(o());n.push([e.id,"[data-v-1613a356]  .resource-yaml{flex:1;display:flex;flex-direction:column}[data-v-1613a356]  .resource-yaml .yaml-editor{flex:1;min-height:200px}[data-v-1613a356]  .resource-yaml .yaml-editor .code-mirror .CodeMirror{min-height:200px}",""]),t["default"]=n},47905:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),l=a(40935),r=a.n(l),n=r()(o());n.push([e.id,".yaml[data-v-2d3a6d84]{height:350px;overflow:auto}[data-v-2d3a6d84]  .resource-yaml{flex:1;display:flex;flex-direction:column}[data-v-2d3a6d84]  .resource-yaml .yaml-editor{flex:1;min-height:350px}[data-v-2d3a6d84]  .resource-yaml .yaml-editor .code-mirror .CodeMirror{min-height:350px}",""]),t["default"]=n},87582:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),l=a(40935),r=a.n(l),n=r()(o());n.push([e.id,".infoBox[data-v-697c87ca]{position:relative}.remove-vol[data-v-697c87ca]{position:absolute;top:10px;right:16px;padding:0;max-height:28px;min-height:28px}",""]),t["default"]=n},44202:function(e,t,a){"use strict";a.r(t);var s=a(36758),o=a.n(s),l=a(40935),r=a.n(l),n=r()(o());n.push([e.id,".box[data-v-16221464]{position:relative}.title[data-v-16221464]{display:flex}.title .state[data-v-16221464]{font-size:16px}.remove[data-v-16221464]{position:absolute;top:10px;right:10px;padding:0}.bootOrder[data-v-16221464]{display:flex;align-items:center}.buttons[data-v-16221464]{width:100%;display:flex;justify-content:flex-end}.volume-status[data-v-16221464]:first-letter{text-transform:uppercase}.resource-external[data-v-16221464]{display:flex;justify-content:center;align-items:center}.banner[data-v-16221464]{margin:10px 0}",""]),t["default"]=n},154:function(e,t,a){"use strict";var s=a(68851);t.A={computed:{conditions(){return this.value?.conditions||[]},readyCondition(){return(0,s.cy)(this.conditions)?(0,s.jq)(this.conditions,"type","Ready")||{}:this.conditions.Ready},schedulableCondition(){return(0,s.cy)(this.conditions)?(0,s.jq)(this.conditions,"type","Schedulable")||{}:this.conditions.Schedulable}}}},84388:function(e,t,a){var s=a(19044);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("32886c2c",s,!0,{sourceMap:!1,shadowMode:!1})},38239:function(e,t,a){var s=a(67647);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("9e59092a",s,!0,{sourceMap:!1,shadowMode:!1})},27461:function(e,t,a){var s=a(34213);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("05d24086",s,!0,{sourceMap:!1,shadowMode:!1})},71157:function(e,t,a){var s=a(67381);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("df2188a2",s,!0,{sourceMap:!1,shadowMode:!1})},9729:function(e,t,a){var s=a(47905);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("5e97709f",s,!0,{sourceMap:!1,shadowMode:!1})},89982:function(e,t,a){var s=a(87582);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("6b7d4a78",s,!0,{sourceMap:!1,shadowMode:!1})},32298:function(e,t,a){var s=a(44202);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var o=a(74825).A;o("4ecbeacc",s,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=harvester-1.0.1.umd.min.648.js.map